<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Durak Online</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Crimson+Pro:wght@400;600&display=swap');
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0a1828;--bg-s:#1a2332;--bg-c:#2a3544;--red:#dc143c;--gold:#ffd700;--txt:#fff;--txt-s:#a8b2c1;--brd:#3a4554}
body{font-family:'Crimson Pro',serif;background:linear-gradient(135deg,#0a1828 0%,#1a2332 50%,#0f1820 100%);color:var(--txt);min-height:100vh;overflow-x:hidden}
.noise{position:fixed;top:0;left:0;width:100%;height:100%;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");pointer-events:none;z-index:9}
.container{max-width:1400px;margin:0 auto;padding:20px;position:relative;z-index:10}
.header{text-align:center;padding:20px 0;background:linear-gradient(90deg,var(--red),var(--gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.header h1{font-family:'Bebas Neue',sans-serif;font-size:4rem}
.screen{display:none;animation:f .5s}
.screen.active{display:block}
@keyframes f{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.login-box{max-width:400px;margin:80px auto;background:var(--bg-s);padding:40px;border-radius:20px;border:2px solid var(--brd);text-align:center}
input{width:100%;padding:15px;margin:20px 0;background:var(--bg-c);border:2px solid var(--brd);color:#fff;border-radius:10px}
.btn{width:100%;padding:15px;border:none;border-radius:10px;font-family:'Bebas Neue',sans-serif;cursor:pointer;transition:.3s;text-transform:uppercase;font-size:1.2rem}
.btn-p{background:linear-gradient(135deg,var(--red),#b91030);color:#fff}
.btn-s{background:var(--bg-c);color:#fff;border:1px solid var(--brd)}
.btn:disabled{opacity:.5}
.lobby-grid{display:grid;grid-template-columns:300px 1fr;gap:20px;margin-top:20px}
.sidebar,.main-area{background:var(--bg-s);padding:20px;border-radius:15px;border:2px solid var(--brd)}
.table{background:linear-gradient(135deg,#1a4d2e 0%,#2d5f3d 100%);border-radius:20px;padding:30px;min-height:350px;border:3px solid var(--gold);margin:20px 0;display:flex;flex-wrap:wrap;gap:15px;justify-content:center;align-items:center}
.card{width:80px;height:120px;background:#fff;border-radius:8px;display:flex;flex-direction:column;justify-content:space-between;padding:8px;cursor:pointer;color:#000;font-weight:700;box-shadow:0 4px 8px rgba(0,0,0,.3)}
.card.red{color:var(--red)}
.hand{background:var(--bg-s);padding:20px;border-radius:15px;border:2px solid var(--brd);display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.8);z-index:99;justify-content:center;align-items:center}
.modal.active{display:flex}
.m-cont{background:var(--bg-s);padding:40px;border-radius:20px;border:2px solid var(--gold);text-align:center}
</style>
</head>
<body>
<div class="noise"></div>
<div class="container">
<div class="header"><h1>? DURAK ?</h1><p>Online Experience</p></div>
<div id="L" class="screen active">
<div class="login-box"><h2>Join Game</h2><input type="text" id="ni" placeholder="Nickname..." maxlength="15"><button class="btn btn-p" onclick="jL()">Enter Lobby</button></div>
</div>
<div id="LB" class="screen">
<div class="lobby-grid">
<div class="sidebar"><h3 id="un">Player</h3><p style="color:var(--txt-s);margin:15px 0 5px">Online:</p><div id="pL"></div><button class="btn btn-s" onclick="location.reload()" style="margin-top:20px;font-size:.8rem">Logout</button></div>
<div class="main-area"><h2>Room</h2><div id="iP" style="margin:20px 0;display:flex;gap:10px"></div><button class="btn btn-p" id="sB" onclick="sG()" disabled>Start Match</button></div>
</div>
</div>
<div id="G" class="screen">
<div style="display:flex;justify-content:space-between;font-family:'Bebas Neue';font-size:1.5rem"><div id="tD">Trump: </div><div id="dC">Deck: 36</div></div>
<div class="table" id="tZ"></div>
<div class="hand" id="pC"></div>
<div style="margin-top:20px;display:flex;gap:15px;justify-content:center">
<button class="btn btn-p" id="dB" onclick="fT()" style="width:auto;padding:10px 30px;display:none">Done/Pass</button>
<button class="btn btn-s" id="tB" onclick="tK()" style="width:auto;padding:10px 30px;display:none">Take</button>
</div>
</div>
</div>
<div id="iM" class="modal"><div class="m-cont"><h2 id="iT">Invitation!</h2><div style="display:flex;gap:10px;margin-top:20px"><button class="btn btn-p" onclick="aI()">Accept</button><button class="btn btn-s" onclick="dI()">Decline</button></div></div></div>
<script type="module">
import{initializeApp}from'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
import{getDatabase,ref,set,get,onValue,update,remove,onDisconnect}from'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
const conf={apiKey:"AIzaSyBrBv6EbZ4Yx7bm1Gp_4IOS-aSN2jit6XM",authDomain:"durak-play-online.firebaseapp.com",databaseURL:"https://durak-play-online-default-rtdb.europe-west1.firebasedatabase.app",projectId:"durak-play-online"};
const app=initializeApp(conf);const db=getDatabase(app);
let u=null,gId=null,invs=new Set(),curI=null;
const st=['?','?','?','?'],vl=['6','7','8','9','10','J','Q','K','A'];
window.jL=async()=>{const n=document.getElementById('ni').value;if(n.length<3)return;u={id:'u_'+Date.now(),n};await set(ref(db,'players/'+u.id),{n,online:true});onDisconnect(ref(db,'players/'+u.id)).remove();document.getElementById('un').textContent=n;sw('LB');liP();liI()};
function liP(){onValue(ref(db,'players'),s=>{const p=s.val()||{};const l=document.getElementById('pL');l.innerHTML='';Object.entries(p).forEach(([id,d])=>{if(id===u.id)return;const b=document.createElement('button');b.className='btn btn-s';b.style.marginBottom='5px';b.style.fontSize='.8rem';b.textContent=d.n+' +';b.onclick=()=>inv(id);l.appendChild(b)})})}
function inv(id){invs.add(id);set(ref(db,`invitations/${id}/${u.id}`),{f:u.n,s:'p'});upL()}
function upL(){const c=document.getElementById('iP');c.innerHTML='';invs.forEach(()=>{const d=document.createElement('div');d.textContent='Invited...';c.appendChild(d)});document.getElementById('sB').disabled=invs.size===0}
function liI(){onValue(ref(db,`invitations/${u.id}`),s=>{const i=s.val()||{};Object.entries(i).forEach(([fId,d])=>{if(d.s==='p'){curI={fId,...d};document.getElementById('iT').textContent=d.f+' invites you!';document.getElementById('iM').classList.add('active')}})});onValue(ref(db,'activeGames'),s=>{const gs=s.val()||{};Object.entries(gs).forEach(([id,g])=>{if(g.players.includes(u.id)){gId=id;sw('G');liG()}})})}
window.aI=()=>{update(ref(db,`invitations/${u.id}/${curI.fId}`),{s:'a'});document.getElementById('iM').classList.remove('active')};
window.dI=()=>{remove(ref(db,`invitations/${u.id}/${curI.fId}`));document.getElementById('iM').classList.remove('active')};
window.sG=async()=>{const p=[u.id,...Array.from(invs)];const d=[];st.forEach(s=>vl.forEach(v=>d.push({s,v})));for(let i=d.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[d[i],d[j]]=[d[j],d[i]]}
const h={};p.forEach(id=>h[id]=d.splice(0,6));const t=d[d.length-1];const gid='g_'+Date.now();await set(ref(db,'activeGames/'+gid),{players:p,deck:d,trump:t,hands:h,table:[],attacker:p[0],defender:p[1],status:'playing'})};
function liG(){onValue(ref(db,`activeGames/${gId}`),s=>{const g=s.val();if(g)rnG(g)})}
function rnG(g){const tZ=document.getElementById('tZ');tZ.innerHTML='';(g.table||[]).forEach(c=>tZ.appendChild(crC(c)));const h=g.hands[u.id]||[];const pC=document.getElementById('pC');pC.innerHTML='';h.forEach((c,i)=>{const d=crC(c);d.onclick=()=>pCa(i,g);pC.appendChild(d)});document.getElementById('tD').textContent='Trump: '+g.trump.s+' '+g.trump.v;document.getElementById('dC').textContent='Deck: '+g.deck.length;const isA=g.attacker===u.id,isD=g.defender===u.id;document.getElementById('dB').style.display=isA?'block':'none';document.getElementById('tB').style.display=isD?'block':'none'}
function crC(c){const d=document.createElement('div');const r=c.s==='?'||c.s==='?';d.className=`card${r?' red':''}`;d.innerHTML=`<span>${c.v}</span><span style="font-size:2rem">${c.s}</span><span>${c.v}</span>`;return d}
async function pCa(i,g){const c=g.hands[u.id][i];const nH=[...g.hands[u.id]];nH.splice(i,1);const nT=[...(g.table||[]),c];const ups={};ups[`hands/${u.id}`]=nH;ups[`table`]=nT;await update(ref(db,`activeGames/${gId}`),ups)}
window.fT=async()=>{const s=await get(ref(db,`activeGames/${gId}`));const g=s.val();const nA=g.defender,nDi=(g.players.indexOf(nA)+1)%g.players.length;await update(ref(db,`activeGames/${gId}`),{table:[],attacker:nA,defender:g.players[nDi]})};
function sw(id){document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));document.getElementById(id).classList.add('active')}
</script>
</body>
</html>